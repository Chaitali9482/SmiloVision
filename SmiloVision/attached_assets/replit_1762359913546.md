# ToothCheck - Dental Health Analysis Application

## Overview

ToothCheck is a Streamlit-based web application that performs automated dental health analysis using computer vision. The application allows users to upload teeth images and receive comprehensive analysis reports covering aspects like tooth yellowness, cavity detection, and alignment scoring. It features a dual-mode interface (standard and kid-friendly) with a gamification system that rewards users with stars and coins for regular dental health monitoring.

## User Preferences

Preferred communication style: Simple, everyday language.

## System Architecture

### Frontend Architecture

**Framework Choice: Streamlit**
- **Rationale**: Streamlit provides rapid prototyping for data-driven applications with minimal frontend code
- **Pros**: Fast development, built-in state management, easy data visualization integration
- **Cons**: Limited customization compared to traditional web frameworks, server-side rendering only

**State Management**
- Uses Streamlit's native session state for maintaining application state across reruns
- Key state variables: `current_screen`, `kid_mode`, `current_image`, `analysis_results`, `user_rewards`
- Component instances (analyzer, report generator, database) are cached in session state for performance

**UI Patterns**
- Sidebar navigation for mode switching and main controls
- Wide layout configuration for better image display
- Dual-mode interface: standard mode for adults, kid mode with simplified language and gamification elements

### Backend Architecture

**Modular Component Design**
- **TeethAnalyzer**: Handles all image processing and analysis logic using OpenCV and scikit-image
- **ReportGenerator**: Creates PDF reports using ReportLab with custom styling
- **Database**: Manages data persistence and retrieval operations
- **Rationale**: Separation of concerns allows independent testing and maintenance of each module

**Image Processing Pipeline**
- Quality checks (lighting, blur, framing) before analysis
- Multi-metric analysis system: yellowness detection, cavity scoring, alignment assessment
- Uses computer vision techniques: Laplacian variance for blur detection, grayscale conversion, contrast analysis
- **Chosen approach**: OpenCV + scikit-image combination provides robust image processing capabilities

**Analysis Scoring System**
- Individual scores for yellowness, cavities, and alignment
- Overall composite score calculation
- Thresholds configured for quality gates (blur_threshold: 100, brightness range: 50-200)

### Data Storage

**Database: SQLite**
- **Rationale**: Lightweight, serverless, requires no configuration - ideal for single-user desktop/web application
- **Schema Design**:
  - `scans`: Stores historical scan data with scores and analysis metadata
  - `user_progress`: Tracks gamification metrics (stars, coins, total scans)
  - `reminders`: Manages scheduled dental care reminders
- **Data Serialization**: JSON format for complex analysis_data storage within SQLite

**Session State vs Persistent Storage**
- Transient data (current image, active analysis) stored in Streamlit session state
- Historical data and user progress persisted to SQLite
- **Trade-off**: Session state provides fast access but requires database sync for persistence

### Report Generation

**PDF Generation: ReportLab**
- Custom styled reports with headers, tables, and embedded images
- Predefined styles for consistency (CustomTitle, CustomSubtitle, SectionHeader)
- Support for multiple page sizes (Letter, A4)
- **Alternative considered**: HTML/CSS reports, rejected due to less precise formatting control

### Gamification System

**Reward Mechanism**
- Stars and coins awarded for scan completions
- Progress tracking with last_scan_date to encourage regular use
- Integration with database for persistent reward state
- **Purpose**: Increase user engagement, particularly effective in kid mode

## External Dependencies

### Core Python Libraries

**Computer Vision & Image Processing**
- `opencv-python (cv2)`: Primary image processing, quality checks, blur detection
- `scikit-image`: Advanced morphological operations, filtering, measurements
- `Pillow (PIL)`: Image format conversions and basic manipulations
- `numpy`: Array operations and numerical computations for image data

**Visualization**
- `matplotlib`: Static plot generation for analysis visualizations
- `plotly`: Interactive charts (express and graph_objects) for progress tracking
- `streamlit`: Web application framework and UI components

**Report Generation**
- `reportlab`: PDF creation with custom styling and layouts

**Data Management**
- `pandas`: Data manipulation for historical scan data and progress tracking
- `sqlite3`: Built-in Python library for database operations

**Utilities**
- `datetime`: Timestamp management for scans and reminders
- `json`: Serialization of complex analysis data
- `base64`: Image encoding for data transfer
- `io.BytesIO`: In-memory file operations

### Database

**SQLite (Local File-Based)**
- Database file: `toothcheck.db`
- No external database server required
- Suitable for single-user deployment
- Migration path available if multi-user support needed (could migrate to PostgreSQL)

### File System Dependencies

**Local Storage**
- Temporary image storage during analysis
- PDF report output location
- Database file persistence
- No cloud storage integration in current implementation